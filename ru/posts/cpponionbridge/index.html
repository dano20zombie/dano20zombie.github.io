<!DOCTYPE html>
<html lang="ru">
<head>
  
    <title>CppOnionBridge: Инновация в анонимном доступе к интернету :: Блог dano20zombie</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Исследуйте CppOnionBridge, идеальное решение для анонимного просмотра интернета. В этом посте рассматривается, как проект обеспечивает безопасный и защищенный доступ к сайтам и API через сеть Tor, подчеркивая важность конфиденциальности и онлайн-безопасности в цифровую эпоху. Идеально подходит для пользователей Windows, желающих улучшить свой онлайн-опыт, сохраняя при этом свою цифровую идентичность в безопасности." />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="https://dano20zombie.github.io/ru/posts/cpponionbridge/" />






  
  
  
  
  
  <link rel="stylesheet" href="https://dano20zombie.github.io/styles.css">







  <link rel="shortcut icon" href="https://dano20zombie.github.io/favicon.ico">



<meta name="twitter:card" content="summary" />



<meta property="og:locale" content="ru" />
<meta property="og:type" content="article" />
<meta property="og:title" content="CppOnionBridge: Инновация в анонимном доступе к интернету">
<meta property="og:description" content="Исследуйте CppOnionBridge, идеальное решение для анонимного просмотра интернета. В этом посте рассматривается, как проект обеспечивает безопасный и защищенный доступ к сайтам и API через сеть Tor, подчеркивая важность конфиденциальности и онлайн-безопасности в цифровую эпоху. Идеально подходит для пользователей Windows, желающих улучшить свой онлайн-опыт, сохраняя при этом свою цифровую идентичность в безопасности." />
<meta property="og:url" content="https://dano20zombie.github.io/ru/posts/cpponionbridge/" />
<meta property="og:site_name" content="Блог dano20zombie" />

  
    <meta property="og:image" content="https://dano20zombie.github.io/favicon.ico">
  

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">

  <meta property="article:section" content="Безопасность" />

  <meta property="article:section" content="Технология" />


  <meta property="article:published_time" content="2024-02-17 00:00:00 &#43;0000 UTC" />












</head>
<body class="red">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/ru">
  <div class="logo">
    Блог dano20zombie
  </div>
</a>

    </div>
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;▾</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="/ru/showcase">Витрина</a></li>
        
      
        
          <li><a href="/ru/about">Обо мне</a></li>
        
      
      
        <hr />
        
          <li>
            <a href="https://dano20zombie.github.io/en/">English</a>
          </li>
        
          <li>
            <a href="https://dano20zombie.github.io/zh/">中文</a>
          </li>
        
          <li>
            <a href="https://dano20zombie.github.io/es/">Español</a>
          </li>
        
          <li>
            <a href="https://dano20zombie.github.io/fr/">Français</a>
          </li>
        
          <li>
            <a href="https://dano20zombie.github.io/it/">Italiano</a>
          </li>
        
          <li>
            <a href="https://dano20zombie.github.io/ar/">العربية</a>
          </li>
        
          <li>
            <a href="https://dano20zombie.github.io/de/">Deutsch</a>
          </li>
        
          <li>
            <a href="https://dano20zombie.github.io/ru/">Русский</a>
          </li>
        
      
    </ul>
  </li>
</ul>

    
    
      <ul class="menu menu--desktop menu--language-selector">
  <li class="menu__trigger">Русский&nbsp;▾</li>
  <li>
    <ul class="menu__dropdown">
      
        <li><a href="https://dano20zombie.github.io/en/">English</a></li>
      
        <li><a href="https://dano20zombie.github.io/zh/">中文</a></li>
      
        <li><a href="https://dano20zombie.github.io/es/">Español</a></li>
      
        <li><a href="https://dano20zombie.github.io/fr/">Français</a></li>
      
        <li><a href="https://dano20zombie.github.io/it/">Italiano</a></li>
      
        <li><a href="https://dano20zombie.github.io/ar/">العربية</a></li>
      
        <li><a href="https://dano20zombie.github.io/de/">Deutsch</a></li>
      
        <li><a href="https://dano20zombie.github.io/ru/">Русский</a></li>
      
    </ul>
  </li>
</ul>

    
  </div>
  
    <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
        
          <li><a href="/ru/showcase" >Витрина</a></li>
        
      
        
          <li><a href="/ru/about" >Обо мне</a></li>
        
      
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="https://dano20zombie.github.io/ru/posts/cpponionbridge/">CppOnionBridge: Инновация в анонимном доступе к интернету</a>
  </h1>
  <div class="post-meta"><time class="post-date">2024-02-17</time><span class="post-reading-time">7 min read (1421 words)</span></div>

  
    <span class="post-tags">
      
      #<a href="https://dano20zombie.github.io/ru/tags/cpponionbridge/">CppOnionBridge</a>&nbsp;
      
      #<a href="https://dano20zombie.github.io/ru/tags/%D1%81%D0%B5%D1%82%D1%8C-tor/">Сеть Tor</a>&nbsp;
      
      #<a href="https://dano20zombie.github.io/ru/tags/%D0%BE%D0%BD%D0%BB%D0%B0%D0%B9%D0%BD-%D0%B0%D0%BD%D0%BE%D0%BD%D0%B8%D0%BC%D0%BD%D0%BE%D1%81%D1%82%D1%8C/">Онлайн-анонимность</a>&nbsp;
      
      #<a href="https://dano20zombie.github.io/ru/tags/%D0%BA%D0%B8%D0%B1%D0%B5%D1%80%D0%B1%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D1%8C/">Кибербезопасность</a>&nbsp;
      
      #<a href="https://dano20zombie.github.io/ru/tags/c&#43;&#43;/">C&#43;&#43;</a>&nbsp;
      
    </span>
  
  


  

  <div class="post-content"><div>
        <h2 id="отказ-от-ответственности">Отказ от ответственности<a href="#отказ-от-ответственности" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>Этот пост и проект CppOnionBridge нацелены на продвижение онлайн-конфиденциальности и безопасности. Использование инструментов для анонимного просмотра интернета должно всегда осуществляться в соответствии с местными законами и правилами. Напоминаем вам, что ответственность за использование таких инструментов лежит на конечном пользователе. Этот контент предоставляется &ldquo;как есть&rdquo;, без каких-либо гарантий относительно его точности или актуальности.</p>
<h2 id="введение">Введение<a href="#введение" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>В текущем контексте, где онлайн-конфиденциальность постоянно находится под угрозой, <strong>CppOnionBridge</strong> представляет себя как передовое решение для обеспечения анонимного и безопасного доступа в Интернет. Этот проект, разработанный с упором на среды Windows, позволяет безопасно перемещаться по сайтам и API через сеть Tor, используя протокол SOCKS5.</p>
<h2 id="видение">Видение<a href="#видение" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>Видение за <strong>CppOnionBridge</strong> ясно: предоставить инструмент, который не только защищает онлайн-идентичность пользователей, но также делает доступ к силе сети Tor доступным для разработчиков и конечных пользователей с минимальными техническими усилиями. Этот проект инкапсулирует сложность соединений SSL/TLS и запросов HTTP(S) через Tor, позволяя сосредоточиться на функциональности приложения.</p>
<h2 id="особенности-и-преимущества">Особенности и Преимущества<a href="#особенности-и-преимущества" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<ul>
<li><strong>Простота Интеграции</strong>: Разработанный для легкой интеграции в приложения C++, <strong>CppOnionBridge</strong> снижает барьер для разработки безопасных приложений.</li>
<li><strong>Минимальные Зависимости</strong>: С зависимостями только от Boost для сетевых и системных операций и от OpenSSL для зашифрованных соединений, он остается легким и агностичным к окружению разработки.</li>
<li><strong>Совместимость с SOCKS5</strong>: Обеспечивает плавное и безопасное взаимодействие с сетью Tor, открывая путь для широкого спектра приложений, требующих анонимности и безопасности.</li>
</ul>
<h2 id="что-такое-socks5">Что такое SOCKS5<a href="#что-такое-socks5" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>SOCKS - это интернет-протокол, который обменивается сетевыми пакетами между клиентом и сервером через прокси-сервер. SOCKS5 по желанию предоставляет аутентификацию, так что только авторизованные пользователи могут получить доступ к серверу.</p>
<h2 id="почему-socks5">Почему SOCKS5<a href="#почему-socks5" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>Протокол SOCKS5 был выбран из-за его гибкости и безопасности. Его клиент-серверная архитектура позволяет инкапсулировать запросы HTTP(S) и соединения SSL/TLS через Tor, обеспечивая безопасное и анонимное взаимодействие с сетью. Более того, его совместимость с широким спектром приложений делает его идеальным выбором для обеспечения анонимности и онлайн-безопасности. (<a href="https://en.wikipedia.org/wiki/SOCKS">Wikipedia</a>)
Сервер SOCKS5 действует как прокси между вами и конечным хостом, отправляя пакеты с вашего компьютера на другую сторону соединения и наоборот.
TOR уже предоставляет нам интерфейс SOCKS5, который базируется на стандартном локальном порту 9050, но в этом примере мы будем использовать порт 9150.</p>
<h2 id="как-это-работает">Как это работает<a href="#как-это-работает" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>CppOnionBridge зависит от двух внешних библиотек: Boost и OpenSSL, поэтому давайте начнем с их включения в наш проект:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;boost/asio.hpp&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;boost/beast.hpp&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;boost/beast/http.hpp&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;boost/beast/ssl.hpp&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;boost/beast/version.hpp&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;boost/asio/connect.hpp&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;boost/asio/ip/tcp.hpp&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;boost/asio/ssl/error.hpp&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;boost/asio/ssl/stream.hpp&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#pragma comment(lib, &#34;libcrypto64MD.lib&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#pragma comment(lib, &#34;libssl64MD.lib&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;Windows.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Definizioni di namespace per semplificare il codice
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">namespace</span> beast <span style="color:#f92672">=</span> boost<span style="color:#f92672">::</span>beast;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> http <span style="color:#f92672">=</span> beast<span style="color:#f92672">::</span>http;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> ssl <span style="color:#f92672">=</span> boost<span style="color:#f92672">::</span>asio<span style="color:#f92672">::</span>ssl;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> asio <span style="color:#f92672">=</span> boost<span style="color:#f92672">::</span>asio;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> error <span style="color:#f92672">=</span> boost<span style="color:#f92672">::</span>asio<span style="color:#f92672">::</span>error;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> tcp <span style="color:#f92672">=</span> asio<span style="color:#f92672">::</span>ip<span style="color:#f92672">::</span>tcp;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">static</span> std<span style="color:#f92672">::</span>string <span style="color:#66d9ef">const</span> host <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bible4u2lvhacg4b3to2e2veqpwmrc2c3tjf2wuuqiz332vlwmr4xbad.onion&#34;</span>; <span style="color:#75715e">// Bible4u
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">static</span> std<span style="color:#f92672">::</span>string <span style="color:#66d9ef">const</span> api <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/en/about&#34;</span>; <span style="color:#75715e">// About Page
</span></span></span></code></pre></div><p>После этого, как наш первый фактический шаг, нам нужно создать сокет и подключиться к адресу localhost с нашим указанным портом (127.0.0.1:9150):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>asio<span style="color:#f92672">::</span>io_context io_context;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tcp<span style="color:#f92672">::</span>socket socket(io_context);
</span></span><span style="display:flex;"><span>tcp<span style="color:#f92672">::</span>resolver resolver(io_context);
</span></span><span style="display:flex;"><span>ssl<span style="color:#f92672">::</span>stream<span style="color:#f92672">&lt;</span>tcp<span style="color:#f92672">::</span>socket<span style="color:#f92672">&amp;&gt;*</span> ssl_stream <span style="color:#f92672">=</span> <span style="color:#66d9ef">nullptr</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">auto</span> endpoints <span style="color:#f92672">=</span> resolver.resolve(<span style="color:#e6db74">&#34;127.0.0.1&#34;</span>, <span style="color:#e6db74">&#34;9150&#34;</span>);
</span></span><span style="display:flex;"><span>asio<span style="color:#f92672">::</span>connect(socket, endpoints);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Connessione stabilita con successo.&#34;</span> <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span></code></pre></div><p>Подключившись к сокету, первое, что нужно сделать, это отправить начальное приветствие серверу, чтобы сообщить, что мы хотим использовать протокол SOCKS5.
Для подробной информации о SOCKS5, вы можете обратиться к <a href="https://tools.ietf.org/html/rfc1928">IETF.ORG</a>
Прежде всего, вам нужно знать, что начальное приветствие состоит из трех отдельных байтов последовательно:</p>
<ol>
<li>
<ul>
<li>ВЕРСИЯ СОКЕТА</li>
</ul>
</li>
<li>
<ul>
<li>КОЛИЧЕСТВО МЕТОДОВ АУТЕНТИФИКАЦИИ</li>
</ul>
</li>
<li>
<ul>
<li>МЕТОДЫ АУТЕНТИФИКАЦИИ</li>
</ul>
</li>
</ol>
<p>Для первого байта у нас есть 0x5, что является версией сокета (SOCKS5), второй байт указывает количество методов аутентификации, поддерживаемых клиентом, где в данном случае TOR принимает только один, который равен 0x1, в то время как третий байт указывает выбранный метод аутентификации, который в данном случае будет 0x0, что означает отсутствие аутентификации.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// Send the SOCKS5 greeting.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>socket.send(boost<span style="color:#f92672">::</span>asio<span style="color:#f92672">::</span>buffer(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x05\x01\x00</span><span style="color:#e6db74">&#34;</span>, <span style="color:#ae81ff">3</span>));
</span></span></code></pre></div><p>В этот момент нам просто нужно прочитать ответ, возвращаемый прокси, чтобы узнать, все ли прошло хорошо или нет, прочитав второй байт ответа, который всегда должен быть 0x0.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// Receive the response to the SOCKS5 greeting.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">char</span> response[<span style="color:#ae81ff">2</span>];
</span></span><span style="display:flex;"><span>size_t length <span style="color:#f92672">=</span> socket.receive(boost<span style="color:#f92672">::</span>asio<span style="color:#f92672">::</span>buffer(response, <span style="color:#ae81ff">2</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Check the response to the SOCKS5 greeting.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> (length <span style="color:#f92672">!=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">||</span> response[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;\x00&#39;</span>) <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span></code></pre></div><p>Если все прошло хорошо, нам остается лишь сообщить прокси-серверу о подключении к определенному хосту для нас, чтобы мы могли отправлять и получать запросы.
Мы продолжим таким же образом, как и с начальным приветствием, но с другими байтами. В этом случае у нас есть четыре начальных байта, указанный хост и один или два последних байта для указания порта (HTTP/HTTPS - 80/443).</p>
<ol>
<li>
<ul>
<li>ВЕРСИЯ СОКЕТА</li>
</ul>
</li>
<li>
<ul>
<li>КОМАНДА</li>
</ul>
</li>
<li>
<ul>
<li>ЗАРЕЗЕРВИРОВАНО</li>
</ul>
</li>
<li>
<ul>
<li>ТИП АДРЕСА</li>
</ul>
</li>
<li>
<ul>
<li>ДЛИНА АДРЕСА (ТОЛЬКО ЕСЛИ ТИП ДОМЕНА)</li>
</ul>
</li>
<li>
<ul>
<li>АДРЕС</li>
</ul>
</li>
<li>
<ul>
<li>ПОРТ</li>
</ul>
</li>
</ol>
<p>Первым байтом у нас является 0x5, что является версией сокета (SOCK-5), вторым байтом у нас есть команда, которую мы хотим выполнить, где в данном случае это будет 0x1, что означает подключение, третьим байтом у нас есть зарезервированный байт, который всегда должен быть 0x0, и четвертым байтом у нас есть тип адреса, который мы указываем, где в данном случае это будет 0x3, что означает доменный адрес, но также может быть 0x1 для подключения к IPv4 или 0x4 для подключения к IPv6.
После этих байтов необходимо указать длину домена, к которому мы подключаемся, на пятом байте, и сразу после указать хост через домен, а в последнем одном или двух байтах у нас есть порт для подключения, где наиболее распространены 80 (0x50) для HTTP и 443 (0x01 0xBB) для HTTPS.
Все доступные команды видны и задокументированы на веб-сайте <a href="https://tools.ietf.org/html/rfc1928">IETF.ORG</a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>byte<span style="color:#f92672">*</span> request <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> byte[<span style="color:#ae81ff">256</span>];
</span></span><span style="display:flex;"><span>memset(request, <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">sizeof</span>(request));
</span></span><span style="display:flex;"><span>sprintf(request, <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x05\x01\x00\x03</span><span style="color:#e6db74">%c%s</span><span style="color:#ae81ff">\x01\xBB</span><span style="color:#e6db74">&#34;</span>, <span style="color:#66d9ef">static_cast</span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">char</span><span style="color:#f92672">&gt;</span>(host.size()), host.c_str());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Send the request.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>socket.send(boost<span style="color:#f92672">::</span>asio<span style="color:#f92672">::</span>buffer(request, <span style="color:#ae81ff">7</span> <span style="color:#f92672">+</span> host.size()));
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">delete</span>[] request;
</span></span></code></pre></div><p>Наконец, нам просто нужно, как всегда, проверить ответ сервера, который в этом случае должен быть длиной в десять байт, из которых мы будем читать исключительно второй, так как он возвращает статус нашего запроса.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// Receive the response to the SOCKS5 connection request.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">char</span> buffer[<span style="color:#ae81ff">10</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> length_response <span style="color:#f92672">=</span> socket.receive(boost<span style="color:#f92672">::</span>asio<span style="color:#f92672">::</span>buffer(buffer, <span style="color:#ae81ff">10</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (length_response <span style="color:#f92672">!=</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">||</span> buffer[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;\x00&#39;</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 0x1: General failure of the socket
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 0x2: Connection&#39;s rule not allowed
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 0x3: Network not available
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 0x4: Host not available
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 0x5: Connection refused (SOCK5 not available)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 0x6: Timeout
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 0x7: Command not supported
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 0x8: Address type not supported
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Некоторые onion-домены могут не принимать входящие соединения через SOCK5, в этом случае, если вы не являетесь владельцем домена, мало что можно сделать.
Однако на данный момент мы можем продолжить с отправкой фактического запроса.
Если делается запрос HTTPS, необходимо отправить зашифрованный запрос через SSL-поток с соответствующим рукопожатием, в противном случае сервер не сможет его интерпретировать.
С другой стороны, это следует избегать, если делается запрос HTTP, где в этом случае сервер ожидает четкий запрос, поэтому не зашифрованный.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// Create the SSL stream for the new connection
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>ssl<span style="color:#f92672">::</span>context ctx(ssl<span style="color:#f92672">::</span>context<span style="color:#f92672">::</span>sslv23);
</span></span><span style="display:flex;"><span>ssl_stream <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ssl<span style="color:#f92672">::</span>stream<span style="color:#f92672">&lt;</span>tcp<span style="color:#f92672">::</span>socket<span style="color:#f92672">&amp;&gt;</span>(socket, ctx);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Perform the SSL/TLS handshake
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>ssl_stream<span style="color:#f92672">-&gt;</span>handshake(ssl<span style="color:#f92672">::</span>stream_base<span style="color:#f92672">::</span>client);
</span></span></code></pre></div><p>После выполнения SSL-потока и его рукопожатия (ЕСЛИ НЕОБХОДИМО ДЛЯ HTTPS), мы продолжаем с отправкой фактического запроса:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// Prepare the HTTP request
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>std<span style="color:#f92672">::</span>string target <span style="color:#f92672">=</span> api;
</span></span><span style="display:flex;"><span>http<span style="color:#f92672">::</span>request<span style="color:#f92672">&lt;</span>http<span style="color:#f92672">::</span>string_body<span style="color:#f92672">&gt;</span> req(http<span style="color:#f92672">::</span>verb<span style="color:#f92672">::</span>get, target, <span style="color:#ae81ff">11</span>); <span style="color:#75715e">// Si specifica il metodo (GET/POST/PUT), l&#39;host e la versione dell&#39;HTTP
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>req.set(http<span style="color:#f92672">::</span>field<span style="color:#f92672">::</span>host, host); <span style="color:#75715e">// Si specifica l&#39;host
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>req.set(http<span style="color:#f92672">::</span>field<span style="color:#f92672">::</span>user_agent, <span style="color:#e6db74">&#34;Mozilla/5.0 (Windows NT 6.1; rv:31.0) Gecko/20100101 Firefox/31.0&#34;</span>); <span style="color:#75715e">// Si specifica l&#39;User-Agent (Browser)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>req.set(http<span style="color:#f92672">::</span>field<span style="color:#f92672">::</span>connection, <span style="color:#e6db74">&#34;keep-alive&#34;</span>); <span style="color:#75715e">// Si specifica la connessione come persistente (Opzionale)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Send the HTTP request over the SSL connection
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>http<span style="color:#f92672">::</span>write(<span style="color:#f92672">*</span>ssl_stream, req);
</span></span></code></pre></div><p>На данном этапе остается лишь получить ответ на наш запрос вместе с кодом завершения, чтобы узнать результат запроса.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// Receive the HTTP response
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>beast<span style="color:#f92672">::</span>flat_buffer buffer;
</span></span><span style="display:flex;"><span>http<span style="color:#f92672">::</span>response<span style="color:#f92672">&lt;</span>http<span style="color:#f92672">::</span>dynamic_body<span style="color:#f92672">&gt;</span> res;
</span></span><span style="display:flex;"><span>http<span style="color:#f92672">::</span>read(<span style="color:#f92672">*</span>ssl_stream, buffer, res); <span style="color:#75715e">//Otteniamo la risposta e salviamola in res
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>string req_response <span style="color:#f92672">=</span> beast<span style="color:#f92672">::</span>buffers_to_string(res.body().data()); <span style="color:#75715e">// Convertiamo la risposta in una stringa
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (res.result_int() <span style="color:#f92672">!=</span> <span style="color:#ae81ff">200</span>) <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>; <span style="color:#75715e">// 200 = HTTP_OK
</span></span></span></code></pre></div><p>После завершения нашего запроса, нам необходимо закрыть соединение с прокси-сервером и освободить выделенную память для потока SSL:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>boost<span style="color:#f92672">::</span>system<span style="color:#f92672">::</span>error_code ec;
</span></span><span style="display:flex;"><span>ssl_stream<span style="color:#f92672">-&gt;</span>shutdown(ec); <span style="color:#75715e">// Spegniamo lo stream SSL
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">delete</span> ssl_stream;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>socket.close(); <span style="color:#75715e">// Chiudiamo il socket
</span></span></span></code></pre></div><p>И вот мы успешно отправили наш запрос и получили ответ.</p>
<h2 id="руководство-по-установке">Руководство по установке<a href="#руководство-по-установке" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>Для установки <strong>CppOnionBridge</strong> необходимо выполнить несколько предварительных шагов, включая настройку Boost и OpenSSL в вашей среде разработки, а также наличие активного экземпляра службы Tor, настроенной на работу через порт 9150.</p>
<h3 id="шаги-установки">Шаги установки:<a href="#шаги-установки" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<ol>
<li>Убедитесь, что Boost и OpenSSL установлены и правильно настроены в системе.</li>
<li>Проверьте, что служба Tor активна и настроена на подключение через порт 9150.</li>
<li>Клонируйте репозиторий GitHub <strong>CppOnionBridge</strong> и включите его в свой проект.</li>
</ol>
<h2 id="участвуйте-в-проекте">Участвуйте в проекте<a href="#участвуйте-в-проекте" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p><strong>CppOnionBridge</strong> - это проект с открытым исходным кодом, и участие сообщества необходимо для его непрерывного развития и улучшения. Если вы заинтересованы в участии, будь то через код, документацию или тестирование, посетите <a href="https://github.com/dano20zombie/CppOnionBridge">репозиторий GitHub</a>.</p>
<h2 id="заключение">Заключение<a href="#заключение" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p><strong>CppOnionBridge</strong> представляет собой значительный шаг в направлении демократизации безопасного и анонимного доступа в Интернет. Благодаря легкой интеграции, минимальным зависимостям и совместимости с сетью Tor, он открывает новые горизонты для разработки приложений, уважающих конфиденциальность и безопасность пользователей.</p>
<p>Для получения дополнительных деталей, ссылок и руководств по установке обратитесь к <a href="https://github.com/dano20zombie/CppOnionBridge">полной документации</a>, доступной в репозитории GitHub.</p>

      </div></div>

  
    
  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2024 Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
