<!DOCTYPE html>
<html lang="fr">
<head>
  
    <title>CppOnionBridge: Innovation in Anonymous Internet Access :: Le blog de dano20zombie</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Découvrez CppOnionBridge, la solution ultime pour naviguer anonymement sur Internet. Ce post explore comment le projet offre un accès sécurisé et protégé aux sites onion et aux APIs via le réseau Tor, en mettant l&#39;accent sur l&#39;importance de la vie privée et de la sécurité en ligne à l&#39;ère numérique. Idéal pour les utilisateurs de Windows cherchant à améliorer leur expérience en ligne tout en préservant leur identité numérique." />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="https://dano20zombie.github.io/fr/posts/cpponionbridge/" />






  
  
  
  
  
  <link rel="stylesheet" href="https://dano20zombie.github.io/styles.css">







  <link rel="shortcut icon" href="https://dano20zombie.github.io/favicon.ico">



<meta name="twitter:card" content="summary" />



<meta property="og:locale" content="fr" />
<meta property="og:type" content="article" />
<meta property="og:title" content="CppOnionBridge: Innovation in Anonymous Internet Access">
<meta property="og:description" content="Découvrez CppOnionBridge, la solution ultime pour naviguer anonymement sur Internet. Ce post explore comment le projet offre un accès sécurisé et protégé aux sites onion et aux APIs via le réseau Tor, en mettant l&#39;accent sur l&#39;importance de la vie privée et de la sécurité en ligne à l&#39;ère numérique. Idéal pour les utilisateurs de Windows cherchant à améliorer leur expérience en ligne tout en préservant leur identité numérique." />
<meta property="og:url" content="https://dano20zombie.github.io/fr/posts/cpponionbridge/" />
<meta property="og:site_name" content="Le blog de dano20zombie" />

  
    <meta property="og:image" content="https://dano20zombie.github.io/favicon.ico">
  

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">

  <meta property="article:section" content="Sécurité" />

  <meta property="article:section" content="Technologie" />


  <meta property="article:published_time" content="2024-02-17 00:00:00 &#43;0000 UTC" />












</head>
<body class="red">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/fr">
  <div class="logo">
    Le blog de dano20zombie
  </div>
</a>

    </div>
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;▾</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="/fr/showcase">Vitrine</a></li>
        
      
        
          <li><a href="/fr/about">À propos de moi</a></li>
        
      
      
        <hr />
        
          <li>
            <a href="https://dano20zombie.github.io/en/">English</a>
          </li>
        
          <li>
            <a href="https://dano20zombie.github.io/zh/">中文</a>
          </li>
        
          <li>
            <a href="https://dano20zombie.github.io/es/">Español</a>
          </li>
        
          <li>
            <a href="https://dano20zombie.github.io/fr/">Français</a>
          </li>
        
          <li>
            <a href="https://dano20zombie.github.io/it/">Italiano</a>
          </li>
        
          <li>
            <a href="https://dano20zombie.github.io/ar/">العربية</a>
          </li>
        
          <li>
            <a href="https://dano20zombie.github.io/de/">Deutsch</a>
          </li>
        
          <li>
            <a href="https://dano20zombie.github.io/ru/">Русский</a>
          </li>
        
      
    </ul>
  </li>
</ul>

    
    
      <ul class="menu menu--desktop menu--language-selector">
  <li class="menu__trigger">Français&nbsp;▾</li>
  <li>
    <ul class="menu__dropdown">
      
        <li><a href="https://dano20zombie.github.io/en/">English</a></li>
      
        <li><a href="https://dano20zombie.github.io/zh/">中文</a></li>
      
        <li><a href="https://dano20zombie.github.io/es/">Español</a></li>
      
        <li><a href="https://dano20zombie.github.io/fr/">Français</a></li>
      
        <li><a href="https://dano20zombie.github.io/it/">Italiano</a></li>
      
        <li><a href="https://dano20zombie.github.io/ar/">العربية</a></li>
      
        <li><a href="https://dano20zombie.github.io/de/">Deutsch</a></li>
      
        <li><a href="https://dano20zombie.github.io/ru/">Русский</a></li>
      
    </ul>
  </li>
</ul>

    
  </div>
  
    <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
        
          <li><a href="/fr/showcase" >Vitrine</a></li>
        
      
        
          <li><a href="/fr/about" >À propos de moi</a></li>
        
      
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="https://dano20zombie.github.io/fr/posts/cpponionbridge/">CppOnionBridge: Innovation in Anonymous Internet Access</a>
  </h1>
  <div class="post-meta"><time class="post-date">2024-02-17</time><span class="post-reading-time">8 min read (1687 words)</span></div>

  
    <span class="post-tags">
      
      #<a href="https://dano20zombie.github.io/fr/tags/cpponionbridge/">CppOnionBridge</a>&nbsp;
      
      #<a href="https://dano20zombie.github.io/fr/tags/r%C3%A9seau-tor/">Réseau Tor</a>&nbsp;
      
      #<a href="https://dano20zombie.github.io/fr/tags/anonymat-en-ligne/">Anonymat en Ligne</a>&nbsp;
      
      #<a href="https://dano20zombie.github.io/fr/tags/cybers%C3%A9curit%C3%A9/">Cybersécurité</a>&nbsp;
      
      #<a href="https://dano20zombie.github.io/fr/tags/c&#43;&#43;/">C&#43;&#43;</a>&nbsp;
      
    </span>
  
  


  

  <div class="post-content"><div>
        <h2 id="avertissement">Avertissement<a href="#avertissement" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>Ce post et le projet CppOnionBridge visent à promouvoir la vie privée et la sécurité en ligne. L&rsquo;utilisation d&rsquo;outils pour naviguer anonymement sur Internet doit toujours être effectuée en conformité avec les lois et réglementations locales. Nous vous rappelons que la responsabilité de l&rsquo;utilisation de tels outils incombe à l&rsquo;utilisateur final. Ce contenu est fourni &ldquo;tel quel&rdquo;, sans aucune garantie quant à son exactitude ou à son actualité.</p>
<h2 id="introduction">Introduction<a href="#introduction" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>Dans le contexte actuel, où la vie privée en ligne est constamment menacée, <strong>CppOnionBridge</strong> se présente comme une solution avant-gardiste pour garantir un accès anonyme et sécurisé à Internet. Ce projet, développé en mettant l&rsquo;accent sur les environnements Windows, permet une navigation sécurisée vers les sites onion et les APIs via le réseau Tor, en utilisant le protocole SOCKS5.</p>
<h2 id="vision">Vision<a href="#vision" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>La vision derrière <strong>CppOnionBridge</strong> est claire : fournir un outil qui protège non seulement l&rsquo;identité en ligne des utilisateurs, mais qui rend également le pouvoir du réseau Tor accessible aux développeurs et aux utilisateurs finaux avec un effort technique minimal. Ce projet encapsule la complexité des connexions SSL/TLS et des requêtes HTTP(S) à travers Tor, permettant de se concentrer sur la fonctionnalité de l&rsquo;application.</p>
<h2 id="fonctionnalités-et-avantages">Fonctionnalités et Avantages<a href="#fonctionnalités-et-avantages" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<ul>
<li><strong>Facilité d&rsquo;Intégration</strong> : Conçu pour être facilement intégré dans les applications C++, <strong>CppOnionBridge</strong> abaisse la barrière à l&rsquo;entrée pour le développement d&rsquo;applications sécurisées.</li>
<li><strong>Dépendances Minimales</strong> : Avec seulement des dépendances sur Boost pour les opérations réseau et système et sur OpenSSL pour les connexions chiffrées, il reste léger et agnostique à l&rsquo;environnement de développement.</li>
<li><strong>Compatibilité SOCKS5</strong> : Assure une interaction fluide et sécurisée avec le réseau Tor, ouvrant la voie à une large gamme d&rsquo;applications nécessitant l&rsquo;anonymat et la sécurité.</li>
</ul>
<h2 id="quest-ce-que-socks5">Qu&rsquo;est-ce que SOCKS5<a href="#quest-ce-que-socks5" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>SOCKS est un protocole Internet qui échange des paquets réseau entre un client et un serveur via un serveur proxy. SOCKS5 fournit facultativement une authentification, de sorte que seuls les utilisateurs autorisés peuvent accéder à un serveur.</p>
<h2 id="pourquoi-socks5">Pourquoi SOCKS5<a href="#pourquoi-socks5" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>Le protocole SOCKS5 a été choisi pour sa flexibilité et sa sécurité. Son architecture client-serveur permet d&rsquo;encapsuler les requêtes HTTP(S) et les connexions SSL/TLS à travers Tor, garantissant une interaction sécurisée et anonyme avec le réseau. De plus, sa compatibilité avec une large gamme d&rsquo;applications en fait un choix idéal pour assurer l&rsquo;anonymat et la sécurité en ligne. (<a href="https://en.wikipedia.org/wiki/SOCKS">Wikipedia</a>)
Le serveur SOCKS5 agit comme un proxy entre vous et l&rsquo;hôte final, envoyant des paquets de votre ordinateur de l&rsquo;autre côté de la connexion, et vice versa.
TOR nous fournit déjà une interface SOCKS5, qui est basée sur le port local par défaut 9050, mais dans cet exemple, nous utiliserons le port 9150.</p>
<h2 id="comment-ça-fonctionne">Comment ça fonctionne<a href="#comment-ça-fonctionne" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>CppOnionBridge repose sur deux bibliothèques externes : Boost et OpenSSL, commençons donc par les inclure dans notre projet :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;boost/asio.hpp&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;boost/beast.hpp&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;boost/beast/http.hpp&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;boost/beast/ssl.hpp&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;boost/beast/version.hpp&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;boost/asio/connect.hpp&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;boost/asio/ip/tcp.hpp&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;boost/asio/ssl/error.hpp&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;boost/asio/ssl/stream.hpp&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#pragma comment(lib, &#34;libcrypto64MD.lib&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#pragma comment(lib, &#34;libssl64MD.lib&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;Windows.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Definizioni di namespace per semplificare il codice
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">namespace</span> beast <span style="color:#f92672">=</span> boost<span style="color:#f92672">::</span>beast;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> http <span style="color:#f92672">=</span> beast<span style="color:#f92672">::</span>http;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> ssl <span style="color:#f92672">=</span> boost<span style="color:#f92672">::</span>asio<span style="color:#f92672">::</span>ssl;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> asio <span style="color:#f92672">=</span> boost<span style="color:#f92672">::</span>asio;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> error <span style="color:#f92672">=</span> boost<span style="color:#f92672">::</span>asio<span style="color:#f92672">::</span>error;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> tcp <span style="color:#f92672">=</span> asio<span style="color:#f92672">::</span>ip<span style="color:#f92672">::</span>tcp;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">static</span> std<span style="color:#f92672">::</span>string <span style="color:#66d9ef">const</span> host <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bible4u2lvhacg4b3to2e2veqpwmrc2c3tjf2wuuqiz332vlwmr4xbad.onion&#34;</span>; <span style="color:#75715e">// Bible4u
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">static</span> std<span style="color:#f92672">::</span>string <span style="color:#66d9ef">const</span> api <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/en/about&#34;</span>; <span style="color:#75715e">// About Page
</span></span></span></code></pre></div><p>Ayant fait cela, comme notre première étape réelle, nous devons créer un socket et nous connecter à l&rsquo;adresse locale, avec notre port spécifié (127.0.0.1:9150) :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>asio<span style="color:#f92672">::</span>io_context io_context;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tcp<span style="color:#f92672">::</span>socket socket(io_context);
</span></span><span style="display:flex;"><span>tcp<span style="color:#f92672">::</span>resolver resolver(io_context);
</span></span><span style="display:flex;"><span>ssl<span style="color:#f92672">::</span>stream<span style="color:#f92672">&lt;</span>tcp<span style="color:#f92672">::</span>socket<span style="color:#f92672">&amp;&gt;*</span> ssl_stream <span style="color:#f92672">=</span> <span style="color:#66d9ef">nullptr</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">auto</span> endpoints <span style="color:#f92672">=</span> resolver.resolve(<span style="color:#e6db74">&#34;127.0.0.1&#34;</span>, <span style="color:#e6db74">&#34;9150&#34;</span>);
</span></span><span style="display:flex;"><span>asio<span style="color:#f92672">::</span>connect(socket, endpoints);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Connessione stabilita con successo.&#34;</span> <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span></code></pre></div><p>Une fois connecté au socket, la première chose à faire est d&rsquo;envoyer le salut initial au serveur, pour communiquer que nous voulons utiliser le protocole SOCKS5.
Pour des informations détaillées sur SOCKS5, vous pouvez vous référer à <a href="https://tools.ietf.org/html/rfc1928">IETF.ORG</a>
Principalement, vous devez savoir que le salut initial se compose de trois octets simples en séquence :</p>
<ol>
<li>
<ul>
<li>VERSION DU SOCKET</li>
</ul>
</li>
<li>
<ul>
<li>NOMBRE DE MÉTHODES D&rsquo;AUTHENTIFICATION</li>
</ul>
</li>
<li>
<ul>
<li>MÉTHODES D&rsquo;AUTHENTIFICATION</li>
</ul>
</li>
</ol>
<p>Pour le premier octet, nous avons 0x5, qui est la version du socket (SOCKS5), comme deuxième octet, nous avons le nombre de méthodes d&rsquo;authentification prises en charge par le client, où dans ce cas TOR n&rsquo;accepte qu&rsquo;une seule méthode, qui est 0x1, tandis que le troisième octet spécifie la méthode d&rsquo;authentification choisie, qui dans ce cas sera 0x0, signifiant aucune authentification.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// Send the SOCKS5 greeting.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>socket.send(boost<span style="color:#f92672">::</span>asio<span style="color:#f92672">::</span>buffer(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x05\x01\x00</span><span style="color:#e6db74">&#34;</span>, <span style="color:#ae81ff">3</span>));
</span></span></code></pre></div><p>À ce stade, nous devons simplement lire la réponse renvoyée par le proxy pour savoir si tout s&rsquo;est bien passé ou non, en lisant le deuxième octet de la réponse, qui devrait toujours être 0x0.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// Receive the response to the SOCKS5 greeting.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">char</span> response[<span style="color:#ae81ff">2</span>];
</span></span><span style="display:flex;"><span>size_t length <span style="color:#f92672">=</span> socket.receive(boost<span style="color:#f92672">::</span>asio<span style="color:#f92672">::</span>buffer(response, <span style="color:#ae81ff">2</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Check the response to the SOCKS5 greeting.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> (length <span style="color:#f92672">!=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">||</span> response[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;\x00&#39;</span>) <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span></code></pre></div><p>Si tout s&rsquo;est bien passé, il ne nous reste plus qu&rsquo;à dire au serveur proxy de se connecter à un hôte spécifique pour nous, afin que nous puissions envoyer et recevoir des requêtes.
Nous procéderons de la même manière que pour la salutation initiale mais avec des octets différents. Dans ce cas, nous avons quatre octets initiaux, l&rsquo;hôte spécifié, et un ou deux octets finaux pour spécifier le port (HTTP/HTTPS - 80/443).</p>
<ol>
<li>
<ul>
<li>VERSION DU SOCKET</li>
</ul>
</li>
<li>
<ul>
<li>COMMANDE</li>
</ul>
</li>
<li>
<ul>
<li>RÉSERVÉ</li>
</ul>
</li>
<li>
<ul>
<li>TYPE D&rsquo;ADRESSE</li>
</ul>
</li>
<li>
<ul>
<li>LONGUEUR DE L&rsquo;ADRESSE (UNIQUEMENT SI TYPE DE DOMAINE)</li>
</ul>
</li>
<li>
<ul>
<li>ADRESSE</li>
</ul>
</li>
<li>
<ul>
<li>PORT</li>
</ul>
</li>
</ol>
<p>Comme premier octet, nous avons 0x5, qui est la version du socket (SOCK-5), comme deuxième octet, nous avons la commande que nous voulons exécuter, où dans ce cas ce sera 0x1, signifiant la connexion, comme troisième octet nous avons un octet réservé, qui doit toujours être 0x0, et comme quatrième octet nous avons le type d&rsquo;adresse que nous spécifions, où dans ce cas ce sera 0x3, signifiant une adresse de domaine, mais cela pourrait aussi être 0x1 pour se connecter à un IPv4, ou 0x4 pour se connecter à un IPv6.
Après ces octets, il est nécessaire de spécifier la longueur du domaine auquel se connecter, au cinquième octet, et immédiatement après spécifier l&rsquo;hôte via le domaine, et comme dernier ou deux derniers octets nous avons le port auquel se connecter, où les plus courants sont 80 (0x50) pour HTTP, et 443 (0x01 0xBB) pour HTTPS.
Toutes les commandes disponibles sont visibles et documentées sur le site <a href="https://tools.ietf.org/html/rfc1928">IETF.ORG</a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>byte<span style="color:#f92672">*</span> request <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> byte[<span style="color:#ae81ff">256</span>];
</span></span><span style="display:flex;"><span>memset(request, <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">sizeof</span>(request));
</span></span><span style="display:flex;"><span>sprintf(request, <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x05\x01\x00\x03</span><span style="color:#e6db74">%c%s</span><span style="color:#ae81ff">\x01\xBB</span><span style="color:#e6db74">&#34;</span>, <span style="color:#66d9ef">static_cast</span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">char</span><span style="color:#f92672">&gt;</span>(host.size()), host.c_str());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Send the request.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>socket.send(boost<span style="color:#f92672">::</span>asio<span style="color:#f92672">::</span>buffer(request, <span style="color:#ae81ff">7</span> <span style="color:#f92672">+</span> host.size()));
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">delete</span>[] request;
</span></span></code></pre></div><p>Enfin, nous devons simplement vérifier comme toujours la réponse du serveur, où dans ce cas elle devrait être longue de dix octets, dont nous ne lirons que et exclusivement le deuxième, car il renvoie le statut de notre requête.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// Receive the response to the SOCKS5 connection request.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">char</span> buffer[<span style="color:#ae81ff">10</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> length_response <span style="color:#f92672">=</span> socket.receive(boost<span style="color:#f92672">::</span>asio<span style="color:#f92672">::</span>buffer(buffer, <span style="color:#ae81ff">10</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (length_response <span style="color:#f92672">!=</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">||</span> buffer[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;\x00&#39;</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 0x1: General failure of the socket
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 0x2: Connection&#39;s rule not allowed
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 0x3: Network not available
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 0x4: Host not available
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 0x5: Connection refused (SOCK5 not available)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 0x6: Timeout
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 0x7: Command not supported
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 0x8: Address type not supported
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Certains domaines onion peuvent ne pas accepter les connexions entrantes via SOCK5, dans ce cas, si vous n&rsquo;êtes pas le propriétaire du domaine, il n&rsquo;y a pas grand-chose à faire à ce sujet.
Cependant, à ce stade, nous pouvons procéder à l&rsquo;envoi de la demande réelle.
Si une demande HTTPS est effectuée, il est nécessaire d&rsquo;envoyer la demande chiffrée, via un flux SSL avec le handshake respectif, sinon le serveur ne pourra pas l&rsquo;interpréter.
D&rsquo;autre part, cela devrait être évité si une demande HTTP est effectuée, où dans ce cas le serveur s&rsquo;attend à une demande claire, donc non chiffrée.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// Create the SSL stream for the new connection
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>ssl<span style="color:#f92672">::</span>context ctx(ssl<span style="color:#f92672">::</span>context<span style="color:#f92672">::</span>sslv23);
</span></span><span style="display:flex;"><span>ssl_stream <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ssl<span style="color:#f92672">::</span>stream<span style="color:#f92672">&lt;</span>tcp<span style="color:#f92672">::</span>socket<span style="color:#f92672">&amp;&gt;</span>(socket, ctx);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Perform the SSL/TLS handshake
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>ssl_stream<span style="color:#f92672">-&gt;</span>handshake(ssl<span style="color:#f92672">::</span>stream_base<span style="color:#f92672">::</span>client);
</span></span></code></pre></div><p>Après avoir effectué un flux SSL et son handshake (SI NÉCESSAIRE POUR HTTPS), nous procédons à l&rsquo;envoi de la demande réelle :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// Prepare the HTTP request
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>std<span style="color:#f92672">::</span>string target <span style="color:#f92672">=</span> api;
</span></span><span style="display:flex;"><span>http<span style="color:#f92672">::</span>request<span style="color:#f92672">&lt;</span>http<span style="color:#f92672">::</span>string_body<span style="color:#f92672">&gt;</span> req(http<span style="color:#f92672">::</span>verb<span style="color:#f92672">::</span>get, target, <span style="color:#ae81ff">11</span>); <span style="color:#75715e">// Si specifica il metodo (GET/POST/PUT), l&#39;host e la versione dell&#39;HTTP
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>req.set(http<span style="color:#f92672">::</span>field<span style="color:#f92672">::</span>host, host); <span style="color:#75715e">// Si specifica l&#39;host
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>req.set(http<span style="color:#f92672">::</span>field<span style="color:#f92672">::</span>user_agent, <span style="color:#e6db74">&#34;Mozilla/5.0 (Windows NT 6.1; rv:31.0) Gecko/20100101 Firefox/31.0&#34;</span>); <span style="color:#75715e">// Si specifica l&#39;User-Agent (Browser)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>req.set(http<span style="color:#f92672">::</span>field<span style="color:#f92672">::</span>connection, <span style="color:#e6db74">&#34;keep-alive&#34;</span>); <span style="color:#75715e">// Si specifica la connessione come persistente (Opzionale)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Send the HTTP request over the SSL connection
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>http<span style="color:#f92672">::</span>write(<span style="color:#f92672">*</span>ssl_stream, req);
</span></span></code></pre></div><p>À ce stade, tout ce qui reste est de recevoir enfin la réponse à notre demande ainsi que le code de sortie pour connaître le résultat de la demande.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// Receive the HTTP response
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>beast<span style="color:#f92672">::</span>flat_buffer buffer;
</span></span><span style="display:flex;"><span>http<span style="color:#f92672">::</span>response<span style="color:#f92672">&lt;</span>http<span style="color:#f92672">::</span>dynamic_body<span style="color:#f92672">&gt;</span> res;
</span></span><span style="display:flex;"><span>http<span style="color:#f92672">::</span>read(<span style="color:#f92672">*</span>ssl_stream, buffer, res); <span style="color:#75715e">//Otteniamo la risposta e salviamola in res
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>std<span style="color:#f92672">::</span>string req_response <span style="color:#f92672">=</span> beast<span style="color:#f92672">::</span>buffers_to_string(res.body().data()); <span style="color:#75715e">// Convertiamo la risposta in una stringa
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (res.result_int() <span style="color:#f92672">!=</span> <span style="color:#ae81ff">200</span>) <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>; <span style="color:#75715e">// 200 = HTTP_OK
</span></span></span></code></pre></div><p>Une fois que nous avons terminé avec notre demande, nous devons fermer la connexion avec le serveur proxy et libérer la mémoire allouée pour le flux SSL :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>boost<span style="color:#f92672">::</span>system<span style="color:#f92672">::</span>error_code ec;
</span></span><span style="display:flex;"><span>ssl_stream<span style="color:#f92672">-&gt;</span>shutdown(ec); <span style="color:#75715e">// Spegniamo lo stream SSL
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">delete</span> ssl_stream;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>socket.close(); <span style="color:#75715e">// Chiudiamo il socket
</span></span></span></code></pre></div><p>Et ici, nous avons réussi à faire notre demande et à obtenir la réponse.</p>
<h2 id="guide-dinstallation">Guide d&rsquo;installation<a href="#guide-dinstallation" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>L&rsquo;installation de <strong>CppOnionBridge</strong> nécessite quelques étapes préliminaires, notamment la configuration de Boost et OpenSSL dans votre environnement de développement, ainsi que la présence d&rsquo;une instance active du service Tor configurée pour fonctionner via le port 9150.</p>
<h3 id="étapes-dinstallation-">Étapes d&rsquo;installation :<a href="#étapes-dinstallation-" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<ol>
<li>Assurez-vous que Boost et OpenSSL sont installés et correctement configurés dans le système.</li>
<li>Vérifiez que le service Tor est actif et configuré pour se connecter via le port 9150.</li>
<li>Clonez le dépôt GitHub de <strong>CppOnionBridge</strong> et incluez-le dans votre projet.</li>
</ol>
<h2 id="contribuer-au-projet">Contribuer au projet<a href="#contribuer-au-projet" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p><strong>CppOnionBridge</strong> est un projet open source, et la participation de la communauté est essentielle pour son développement continu et son amélioration. Si vous souhaitez contribuer, que ce soit par le code, la documentation ou les tests, visitez le <a href="https://github.com/dano20zombie/CppOnionBridge">dépôt GitHub</a>.</p>
<h2 id="conclusion">Conclusion<a href="#conclusion" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p><strong>CppOnionBridge</strong> représente une avancée significative vers la démocratisation de l&rsquo;accès sécurisé et anonyme à Internet. Avec sa facilité d&rsquo;intégration, ses dépendances minimales et sa compatibilité avec le réseau Tor, il ouvre de nouvelles perspectives pour le développement d&rsquo;applications respectueuses de la vie privée et de la sécurité des utilisateurs.</p>
<p>Pour plus de détails, de références et de guides d&rsquo;installation, consultez la <a href="https://github.com/dano20zombie/CppOnionBridge">documentation complète</a> disponible sur le dépôt GitHub.</p>

      </div></div>

  
    
  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2024 Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
